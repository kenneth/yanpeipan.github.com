---
layout: post
title: "抽奖算法"
description: ""
category: 
tags: [抽奖, 算法, PHP]
---
{% include JB/setup %}

    $prizes = [
      ['id' => 1, 'prize' => 'A', 'number' => 0, 'probability' => 1],
      ['id' => 2, 'prize' => 'B', 'number' => 1, 'probability' => 1],
      ['id' => 3, 'prize' => 'C', 'number' => 2, 'probability' => 9],
      ['id' => 4, 'prize' => 'D', 'number' => 3, 'probability' => 11],
      ['id' => 5, 'prize' => 'E', 'number' => 9, 'probability' => 100],
    ];
    
    $filter = function($prize) {
        return isset($prize['probability'], $prize['number']) && $prize['number'] > 0 ?
    	    $prize['probability'] : null;
    };
    
    $probabilityPrizes = array_filter(array_combine(array_keys($prizes), array_map($filter, $prizes)));
    $index = randPrizeIndex($probabilityPrizes);
    
    if (isset($prizes[$index])) {
        $prize = $prizes[$index];
    }
    
    function randPrizeIndex($prize) {
      $index = null;
      $probabilitySum = array_sum($prize);
      foreach ($prize as $key => $probability) {
        $rand = mt_rand(1, $probabilitySum);
        if ($rand <= $probability) {
          $index = $key;
          break;
        } else {
          $probabilitySum -= $probability;
        }
      }
      return $index;
    }

